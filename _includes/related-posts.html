<!-- Related Posts
================================================== -->
<br>
<div class="{% unless page.categories == empty %} related-posts {% endunless %}">  
    {% unless page.categories == empty %}
    <hr/>
    <h2 class="text-center mb-4">More related to</h2>
    {% endunless %}
    <div class="d-flex justify-content-center align-items-center">
    
    <!-- Categories -->
    {% assign sortedCategories = page.categories | sort %}
    {% for category in sortedCategories %}
    <a class="smoothscroll badge badge-primary text-capitalize" href="{{site.baseurl}}/categories#{{ category | replace: " ","-" }}">{{ category }}</a>                
    {% endfor %}

    <!-- Tags -->  
    {% assign sortedTags = page.tags | sort %}
    {% for tag in sortedTags %}                
    <a class="smoothscroll badge badge-primary text-capitalize" href="{{site.baseurl}}/tags#{{ tag | replace: " ","-" }}">{{ tag }}</a>               
    {% endfor %}

    </div>

    {% assign maxRelated = 3 %}
    {% assign minCommonTags =  1 %}
    {% assign maxRelatedCounter = 0 %}
    <div class="blog-grid-container">
        {% for post in site.posts %}
        
            {% assign sameTagCount = 0 %}
            {% assign commonTags = '' %}
        
            {% for category in post.categories %}
            {% if post.url != page.url %}
                {% if page.categories contains category %}
                {% assign sameTagCount = sameTagCount | plus: 1 %}
                {% capture tagmarkup %} {{ category }} {% endcapture %}
                {% assign commonTags = commonTags | append: tagmarkup %}
                {% endif %}
            {% endif %}
            {% endfor %}
        
            {% if sameTagCount >= minCommonTags %}
            {% include postbox.html %}
            {% assign maxRelatedCounter = maxRelatedCounter | plus: 1 %}
            {% if maxRelatedCounter >= maxRelated %}
            <div class="d-flex justify-content-center align-items-center">
                <button class="btn btn-light justify-content-end"> View more related content &rarr;</button>
            </div>   
            {% break %}
            {% endif %}
            {% endif %}
        {% endfor %}
        {% if sameTagCount == 0 %}
        </div><p class="text-center mb-4">Looks like there are no more related content.</p></div>
        <div class="post-nav">
            <div class="d-flex flex-row justify-content-between">
                <div class="prev-post"><button type="button" class="btn btn-link">
                    <i class="fa-solid fa-arrow-left-long"></i>    View Previous 
                </button>
                </div>
                <div class="next-post">
                    <button type="button" class="btn btn-link">
                        View Next <i class="fa-solid fa-arrow-right-long"></i>
                    </button> 
                </div>
            </div>
        </div>
        
        {% break %}
        {% endif %}
        </div>       
</div>